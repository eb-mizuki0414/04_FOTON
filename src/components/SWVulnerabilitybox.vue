<template>
  <v-data-table
    :headers="headers"
    :items="desserts"
    sort-by="RiskLevel"
    class="elevation-1"
  >
    <template v-slot:top>
      <v-toolbar flat color="white">
        <p class="elevation-2">SW Vulnerability Table</p>
        <v-divider
          class="mx-4"
          inset
          vertical
        ></v-divider>
        <v-spacer></v-spacer>
        <v-dialog v-model="dialog" max-width="500px">
          <template v-slot:activator="{ on }">
            <v-btn color="primary" dark class="mb-2" v-on="on">Add Item</v-btn>
          </template>
          <v-card>
            <v-card-title>
              <span class="headline">{{ formTitle }}</span>
            </v-card-title>

            <v-card-text>
              <v-container>
                <v-row>
                  <v-col cols="12" sm="6" md="4">
                    <v-text-field v-model="editedItem.name" label="Name"></v-text-field>
                  </v-col>
                  <v-col cols="12" sm="6" md="4">
                    <v-text-field v-model="editedItem.RiskLevel" label="RiskLevel"></v-text-field>
                  </v-col>
                  <v-col cols="12" sm="6" md="4">
                    <v-text-field v-model="editedItem.Package" label="Package"></v-text-field>
                  </v-col>
                  <v-col cols="12" sm="6" md="4">
                    <v-text-field v-model="editedItem.Detail" label="Detail"></v-text-field>
                  </v-col>
                  <v-col cols="12" sm="6" md="4">
                    <v-text-field v-model="editedItem.Comment" label="Comment"></v-text-field>
                  </v-col>
                </v-row>
              </v-container>
            </v-card-text>

            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn color="blue darken-1" text @click="close">Cancel</v-btn>
              <v-btn color="blue darken-1" text @click="save">Save</v-btn>
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-toolbar>
    </template>
    <template v-slot:item.actions="{ item }">
      <v-icon
        small
        class="mr-2"
        @click="editItem(item)"
      >
        mdi-pencil
      </v-icon>
      <v-icon
        small
        @click="deleteItem(item)"
      >
        mdi-delete
      </v-icon>
    </template>
    <template v-slot:no-data>
      <v-btn color="primary" @click="initialize">Reset</v-btn>
    </template>
  </v-data-table>
</template>

<script>
  export default {
    data: () => ({
      dialog: false,
      headers: [
        {
          text: 'Name',
          align: 'start',
          sortable: false,
          value: 'name',
        },
        { text: 'RiskLevel', value: 'RiskLevel' },
        { text: 'Package', value: 'Package' },
        { text: 'Detail', value: 'Detail' },
        { text: 'Comment', value: 'Comment' },
        { text: 'Actions', value: 'actions', sortable: false },
      ],
      desserts: [],
      editedIndex: -1,
      editedItem: {
        name: '',
        RiskLevel: 0,
        Package: 0,
        Detail: 0,
        Comment: 0,
      },
      defaultItem: {
        name: '',
        RiskLevel: 0,
        Package: 0,
        Detail: 0,
        Comment: 0,
      },
    }),

    computed: {
      formTitle () {
        return this.editedIndex === -1 ? 'New Item' : 'Edit Item'
      },
    },

    watch: {
      dialog (val) {
        val || this.close()
      },
    },

    created () {
      this.initialize()
    },

    methods: {
      initialize () {
        this.desserts = [
          {
            name: 'CVE-2020-9383',
            RiskLevel: "LOW",
            Package: "linux:4.9.210-1",
            Detail: "An issue was discovered in the Linux kernel through 5.5.6. set_fdc in drivers/block/floppy.c",
            Comment: "none",
          },
          {
            name: 'CVE-2020-9327',
            RiskLevel: "INFORMATIONAL",
            Package: "sqlite3:3.16.2-5+deb9u1",
            Detail: "	In SQLite 3.31.1, isAuxiliaryVtabOperator allows attackers to trigger a NULL pointer dereference and segmentation fault because of generated column optimizations.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8832',
            RiskLevel: "INFORMATIONAL",
            Package: "linux:4.9.210-1",
            Detail: "The fix for the Linux kernel in Ubuntu 18.04 LTS for CVE-2019-14615 Discovered to be incomplete, meaning that in versions of the kernel before 4.15.0-91.92, an attacker could use this vulnerability to expose sensitive information.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8649',
            RiskLevel: "LOW",
            Package: "linux:4.9.210-1",
            Detail: "There is a use-after-free vulnerability in the Linux kernel through 5.5.2 in the vgacon_invert_region function in drivers/video/console/vgacon.c.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8648',
            RiskLevel: "LOW",
            Package: "linux:4.9.210-",
            Detail: "There is a use-after-free vulnerability in the Linux kernel through 5.5.2 in the n_tty_receive_buf_common function in drivers/tty/n_tty.c.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8647',
            RiskLevel: "HIGH",
            Package: "linux:4.9.210-",
            Detail: "There is a use-after-free vulnerability in the Linux kernel through 5.5.2 in the vc_do_resize function in drivers/tty/vt/vt.c.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8492',
            RiskLevel: "HIGH",
            Package: "python2.7:2.7.13-2+deb9u3",
            Detail: "Python 2.7 through 2.7.17, 3.5 through 3.5.9, 3.6 through 3.6.10, 3.7 through 3.7.6, and 3.8 through 3.8.1 allows an HTTP server to conduct Regular Expression Denial of Service (ReDoS) attacks against a client because of urllib.request.AbstractBasicAuthHandler catastrophic backtracking.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8492',
            RiskLevel: "HIGH",
            Package: "python3.5:3.5.3-1+deb9u1",
            Detail: "Python 2.7 through 2.7.17, 3.5 through 3.5.9, 3.6 through 3.6.10, 3.7 through 3.7.6, and 3.8 through 3.8.1 allows an HTTP server to conduct Regular Expression Denial of Service (ReDoS) attacks against a client because of urllib.request.AbstractBasicAuthHandler catastrophic backtracking",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8428',
            RiskLevel: "INFORMATIONAL",
            Package: "linux:4.9.210-1",
            Detail: "fs/namei.c in the Linux kernel before 5.5 has a may_create_in_sticky use-after-free, which allows local users to cause a denial of service (OOPS) or possibly obtain sensitive information from kernel memory, aka CID-d0cb50185ae9. One attack vector may be an open system call for a UNIX domain socket, if the socket is being moved to a new parent directory and its old parent directory is being removed.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8428',
            RiskLevel: "INFORMATIONAL",
            Package: "linux:4.9.210-1",
            Detail: "fs/namei.c in the Linux kernel before 5.5 has a may_create_in_sticky use-after-free, which allows local users to cause a denial of service (OOPS) or possibly obtain sensitive information from kernel memory, aka CID-d0cb50185ae9. One attack vector may be an open system call for a UNIX domain socket, if the socket is being moved to a new parent directory and its old parent directory is being removed.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-8112 ',
            RiskLevel: "MEDIUM",
            Package: "openjpeg2:2.1.2-1.1+deb9u4",
            Detail: "opj_t1_clbl_decode_processor in openjp2/t1.c in OpenJPEG 2.3.1 through 2020-01-28 has a heap-based buffer overflow in the qmfbid==1 case, a different issue than CVE-2020-6851.",
            Comment: "none",
          },
          {
            name: 'CVE-2020-7595 ',
            RiskLevel: "MEDIUM",
            Package: "libxml2:2.9.4+dfsg1-2.2+deb9u2",
            Detail: "xmlStringLenDecodeEntities in parser.c in libxml2 2.9.10 has an infinite loop in a certain end-of-file situation.",
            Comment: "none",
          }
        ]
      },

      editItem (item) {
        this.editedIndex = this.desserts.indexOf(item)
        this.editedItem = Object.assign({}, item)
        this.dialog = true
      },

      deleteItem (item) {
        const index = this.desserts.indexOf(item)
        confirm('Are you sure you want to delete this item?') && this.desserts.splice(index, 1)
      },

      close () {
        this.dialog = false
        this.$nextTick(() => {
          this.editedItem = Object.assign({}, this.defaultItem)
          this.editedIndex = -1
        })
      },

      save () {
        if (this.editedIndex > -1) {
          Object.assign(this.desserts[this.editedIndex], this.editedItem)
        } else {
          this.desserts.push(this.editedItem)
        }
        this.close()
      },
    },
  }
</script>

<style>
.elevation-1 {
    background-color: #d8d9da !important;
    margin-left: 100px;
    margin-right: auto;
    width: 1200px;
}

.elevation-2 {
  /* background-color: #d8d9da !important; */
  box-shadow: none !important;
  margin-top: 10px;
}

 .v-sheet.v-sheet--tile.theme--light.v-toolbar.v-toolbar--flat {
   background-color: #d8d9da !important;
 }

</style>